{% extends 'base.html' %}

{% block script%}
  <script>

    function getParameterByName(name, url) {
    if (!url) url = window.location.href;
    name = name.replace(/[\[\]]/g, "\\$&");
    var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
        results = regex.exec(url);
    if (!results) return null;
    if (!results[2]) return '';
    return decodeURIComponent(results[2].replace(/\+/g, " "));
}
  $(document).ready(function(){
      console.log('working');
      var query = getParameterByName('q');
      var tweetList = [];

      function parseTweets () {
        if (tweetList == 0) {
          $('#tweet-content').text('No tweet found currently')     
        } else {
          // tweets exist parse and display them 
            $.each(tweetList, function(key, value){
              var tweetUser = value.user;
              var tweetContent = value.content;
              var tweetKey = value.key;
              $('#tweet-content').append(
                "<div class='media'><div class='media-body'>" + tweetContent + '<br /> via ' + tweetUser.username +
                ' | ' + "<a href='#'> View </a>"  +
                "</div></div> <hr /> "
              )
            })
        }
      }
    $.ajax({
      url: '/api/tweet/',
      data: {
        'q': query 
      },
      method: 'GET',
      success: function(data){    
        tweetList = data  
        parseTweets()
    },
      error: function(data){
        console.log('error')}
    })
  })
  </script>
{% endblock script %}

{% block content %}


 <div class="row"> 
  <div class="col-sm-3 col-xs-12"> 
    <h1> {{ request.user }} </h1>
  </div>
  <div class="col-sm-9" >
        {% if not request.GET.q %}
          <div class="">
          {% include "tweets/form.html" with form=create_form action_url=create_url btn_title='Tweet' %}
          </div>
        <hr />
      {% endif %}
      {% for object in object_list %}

      <div id='tweet-content'>

      </div>
  {% endfor %}
   </div>
</div> 
  {% endblock content%}